"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("@diez/cli-core"),r=require("http"),o=e(require("open")),s=e(require("request")),a=e(require("server-destroy")),i=require("url"),n=require("uuid");exports.performGetRequest=((e,r=!0,o)=>new Promise((a,i)=>{s.default({uri:e,headers:o,json:r},(e,r,o)=>{e||200!==r.statusCode?403===r.statusCode||404===r.statusCode?i(new t.UnauthorizedRequestException):i(new Error(e?e.message:o.err)):a(o)})})),exports.performGetRequestWithBearerToken=((e,t)=>exports.performGetRequest(e,!0,{Authorization:`Bearer ${t}`})),exports.getOAuthCodeFromBrowser=((e,t)=>new Promise((s,n)=>{const u=r.createServer(async(e,r)=>{try{if(e){const{searchParams:o}=new i.URL(e.url,`http:localhost:${t}`);r.writeHead(302,{Location:"https://diez.org/signed-in"}),r.end(),u.destroy(),s({code:o.get("code"),state:o.get("state")})}}catch(e){n(e)}}).listen(t,async()=>{(await o.default(e,{wait:!1})).unref()});a.default(u)}));const u=[46572,48735,7826,44495,21902];exports.getFigmaAccessToken=(async()=>{const e=await t.findOpenPort(u),r=n.v4(),o=`http://localhost:${e}`,s=`https://www.figma.com/oauth?${new URLSearchParams([["client_id","dVkwfl8RBD91688fwCq9Da"],["redirect_uri",o],["scope","file_read"],["state",r],["response_type","code"]]).toString()}`,{code:a,state:i}=await exports.getOAuthCodeFromBrowser(s,e);if(r!==i)throw new Error("Security exception!");const c=new URLSearchParams([["code",a],["redirect_uri",o]]),{access_token:d}=await exports.performGetRequest(`https://oauth.diez.org/figma?${c.toString()}`);return d});
//# sourceMappingURL=/@diez/extractors/lib/utils.network.js.map