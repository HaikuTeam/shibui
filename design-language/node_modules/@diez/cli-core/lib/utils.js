"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("async"),r=require("child_process"),n=require("fs-extra"),s=require("os"),o=require("path"),t=require("./reporting"),i=require(o.join("..","package.json"));exports.devDependencies=i.devDependencies,exports.diezVersion=i.version;const c=new Map;exports.execAsync=((e,n)=>new Promise((s,o)=>{r.exec(e,n,(e,r)=>{e?o(e):s(r.toString().trim())})})),exports.isMacOS=(()=>"darwin"===s.platform());const a=(e,r,n=!1)=>{if(r.has(e))return;const s=(e=>{try{return require.resolve(o.join(e,"package.json"))}catch(e){return}})(e);if(!s)return;const t=o.dirname(s),i=require(s);if(r.set(n?".":e,{json:i,path:t}),i.dependencies)for(const e in i.dependencies)try{a(e,r)}catch(e){}if(n&&i.devDependencies)for(const e in i.devDependencies)try{a(e,r)}catch(e){}};exports.findPlugins=((r=global.process.cwd(),s)=>{if(c.size)return Promise.resolve(c);const i=new Map;return a(r,i,!0),s&&a(s,i),new Promise(r=>{e.each(Array.from(i),([e,{json:r,path:s}],i)=>{const a=r.diez||{},p=o.join(s,".diezrc");if(!n.existsSync(p))return i();try{const e=JSON.parse(n.readFileSync(p).toString());Object.assign(a,e)}catch(e){t.Log.warning(`Found invalid .diezrc at ${p}`)}return Object.keys(a).length&&c.set(e,a),i()},()=>{r(c)})})}),exports.cliRequire=((e,r)=>"."===e?require(o.join(global.process.cwd(),r)):require(o.join(e,r))),exports.canRunCommand=(async e=>{try{return!!await exports.execAsync(e)}catch(e){return!1}}),exports.locateBinaryMacOS=(async e=>{if(!exports.isMacOS())throw new Error("Platform is not macOS");const r=await exports.execAsync(`mdfind kMDItemCFBundleIdentifier=${e}`);if(r)return r.split("\n")[0]}),exports.exitTrap=(e=>{global.process.once("exit",e),global.process.once("SIGINT",e),global.process.once("SIGHUP",e),global.process.once("SIGQUIT",e),global.process.once("SIGTSTP",e)});
//# sourceMappingURL=/@diez/cli-core/lib/utils.js.map